<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
    th:fragment="html(content, pageTitle)">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle != null} ? |${pageTitle} - #{app.title}| : |#{app.title} Management System|">EV Warranty
    </title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <!-- ... (sidebar content preserved implicitly via unchanged lines) ... -->

        <!-- ... (main content) ... -->

        <!-- Bootstrap 5 JS Bundle -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script th:src="@{/js/app.js}"></script>
</body>
<!-- Sidebar -->
<aside class="sidebar">
    <div class="sidebar-header">
        <div class="logo">
            <i class="fas fa-car-battery"></i>
            <span>EV Warranty</span>
        </div>
    </div>

    <nav class="sidebar-nav">
        <ul class="list-unstyled mb-0">
            <li class="nav-item">
                <a th:href="@{/dashboard}" class="nav-link"
                    th:classappend="${currentSection == '' or currentSection == null or currentSection == 'dashboard'} ? 'active' : ''">
                    <span th:text="#{menu.dashboard}">Dashboard</span>
                </a>
            </li>

            <!-- Service Center Menu -->
            <li class="nav-item" th:classappend="${currentSection == 'sc'} ? 'active' : ''"
                th:if="${userRoles.contains('ROLE_SC_STAFF') or userRoles.contains('ROLE_SC_TECHNICIAN') or userRoles.contains('ROLE_ADMIN')}">
                <a href="#serviceCenterSubmenu" data-bs-toggle="collapse" aria-expanded="false"
                    class="nav-link dropdown-toggle">
                    <i class="fas fa-wrench"></i>
                    <span th:text="#{menu.sc}">Service Center</span>
                </a>
                <div class="collapse" id="serviceCenterSubmenu"
                    th:classappend="${currentSection == 'sc'} ? 'show' : ''">
                    <ul class="nav-submenu list-unstyled">
                        <li>
                            <a th:href="@{/sc/vehicles}" th:classappend="${currentPage == 'vehicles'} ? 'active' : ''"
                                th:text="#{menu.sc.vehicles}">Vehicles</a>
                        </li>
                        <li>
                            <a th:href="@{/sc/customers}" th:classappend="${currentPage == 'customers'} ? 'active' : ''"
                                th:text="#{menu.sc.customers}">Customers</a>
                        </li>
                        <li>
                            <a th:href="@{/sc/claims}"
                                th:classappend="${currentPage == 'warranty-claims'} ? 'active' : ''"
                                th:text="#{menu.sc.claims}">Warranty Claims</a>
                        </li>
                        <li>
                            <a th:href="@{/sc/inventory}" th:classappend="${currentPage == 'inventory'} ? 'active' : ''"
                                th:text="#{menu.sc.inventory}">Inventory</a>
                        </li>
                    </ul>
                </div>
            </li>

            <!-- Manufacturer Menu -->
            <li class="nav-item" th:classappend="${currentSection == 'evm'} ? 'active' : ''"
                th:if="${userRoles.contains('ROLE_EVM_STAFF') or userRoles.contains('ROLE_ADMIN')}">
                <a href="#manufacturerSubmenu" data-bs-toggle="collapse" aria-expanded="false"
                    class="nav-link dropdown-toggle">
                    <i class="fas fa-industry"></i>
                    <span th:text="#{menu.evm}">Manufacturer</span>
                </a>
                <div class="collapse" id="manufacturerSubmenu"
                    th:classappend="${currentSection == 'evm'} ? 'show' : ''">
                    <ul class="nav-submenu list-unstyled">
                        <li>
                            <a th:href="@{/evm/claims}" th:classappend="${currentPage == 'claims'} ? 'active' : ''"
                                th:text="#{menu.evm.review}">Review
                                Claims</a>
                        </li>
                        <li>
                            <a th:href="@{/evm/parts}" th:classappend="${currentPage == 'parts'} ? 'active' : ''"
                                th:text="#{menu.evm.parts}">Parts
                                Catalog</a>
                        </li>
                        <li>
                            <a th:href="@{/evm/campaigns}"
                                th:classappend="${currentPage == 'campaigns'} ? 'active' : ''"
                                th:text="#{menu.evm.campaigns}">Service Campaigns</a>
                        </li>
                    </ul>
                </div>
            </li>

            <!-- Admin Menu -->
            <li class="nav-item" th:classappend="${currentSection == 'admin'} ? 'active' : ''"
                th:if="${userRoles.contains('ROLE_ADMIN')}">
                <a href="#adminSubmenu" data-bs-toggle="collapse" aria-expanded="false"
                    class="nav-link dropdown-toggle">
                    <i class="fas fa-user-shield"></i>
                    <span th:text="#{menu.admin}">Administration</span>
                </a>
                <div class="collapse" id="adminSubmenu" th:classappend="${currentSection == 'admin'} ? 'show' : ''">
                    <ul class="nav-submenu list-unstyled">
                        <li>
                            <a th:href="@{/admin/users}" th:classappend="${currentPage == 'users'} ? 'active' : ''"
                                th:text="#{menu.admin.users}">User
                                Management</a>
                        </li>
                    </ul>
                </div>
            </li>
        </ul>
    </nav>

    <div class="sidebar-footer">
        <div class="user-info">
            <i class="fas fa-user-circle"></i>
            <span sec:authentication="name">User</span>
        </div>
        <form th:action="@{/logout}" method="post" style="display: inline;">
            <button type="submit" class="btn-logout">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </form>
    </div>
</aside>

<!-- Main Content -->
<main class="main-content">
    <header class="content-header">
        <h1 th:text="${pageTitle != null ? pageTitle : 'Dashboard'}">Page Title</h1>
        <div class="header-actions" th:if="${headerActions}">
            <div th:replace="${headerActions}"></div>
        </div>
        <!-- Header User Info -->
        <div class="d-flex align-items-center gap-3">
            <!-- Language Switcher -->
            <div class="dropdown">
                <button class="btn btn-sm btn-secondary dropdown-toggle" type="button" id="langDropdown"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fas fa-globe"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="langDropdown">
                    <li><a class="dropdown-item" th:href="@{''(lang='en')}">
                            <span th:text="#{lang.en}">English</span> <i th:if="${#locale.language == 'en'}"
                                class="fas fa-check ms-2 text-success"></i>
                        </a></li>
                    <li><a class="dropdown-item" th:href="@{''(lang='vi')}">
                            <span th:text="#{lang.vi}">Tiếng Việt</span> <i th:if="${#locale.language == 'vi'}"
                                class="fas fa-check ms-2 text-success"></i>
                        </a></li>
                </ul>
            </div>

            <!-- Theme Toggle -->
            <button class="btn btn-sm btn-secondary" onclick="toggleTheme()" title="Toggle Theme">
                <i id="theme-icon" class="fas fa-sun"></i>
            </button>

            <!-- User Profile -->
            <div class="ms-auto" style="padding-right: 20px;">
                <span class="navbar-text">
                    <span th:text="#{app.welcome}">Welcome</span>, <span sec:authentication="name"
                        style="font-weight: bold;">User</span>
                    <span th:if="${userRoles.contains('ROLE_ADMIN')}" class="badge bg-danger ms-2">ADMIN</span>
                    <span th:if="${userRoles.contains('ROLE_SC_STAFF')}" class="badge bg-primary ms-2">SC
                        STAFF</span>
                    <span th:if="${userRoles.contains('ROLE_SC_TECHNICIAN')}" class="badge bg-info ms-2">SC
                        TECH</span>
                    <span th:if="${userRoles.contains('ROLE_EVM_STAFF')}" class="badge bg-success ms-2">EVM
                        STAFF</span>
                </span>
            </div>
    </header>

    <!-- Flash Messages -->
    <div th:if="${success}" class="alert alert-success">
        <i class="fas fa-check-circle"></i>
        <span th:text="${success}"></span>
    </div>
    <div th:if="${error}" class="alert alert-error">
        <i class="fas fa-exclamation-circle"></i>
        <span th:text="${error}"></span>
    </div>

    <!-- Page Content -->
    <div class="content-body" th:insert="${content}">
        <!-- Content will be inserted here -->
    </div>
</main>
</div>

<script th:src="@{/js/app.js}"></script>
</body>

</html>